<!-- Generated by Ruler; expanded for agents -->
<!-- Source: .ruler/bts.md + repo inspection -->

# AGENTS Guide for life-os

This repository is a Better-T-Stack monorepo using Bun workspaces and Turborepo.
Primary apps are a Convex backend and a React Native Expo app with Uniwind (Tailwind).

## Project Layout

- `apps/native/` React Native (Expo Router + Uniwind + HeroUI Native)
- `packages/backend/` Convex backend (functions, auth)
- `packages/env/` Shared env parsing helpers
- `packages/config/` Shared tsconfig base
- `bts.jsonc` Better-T-Stack project metadata

## Build, Lint, Typecheck, Test

Run commands from the repo root unless noted. Turborepo handles caching.

- Install deps: `bun install`
- Dev (all): `bun run dev` (Note: This command is always running in the background)
- Dev (native only): `bun run dev:native`
- Dev (backend only): `bun run dev:server`
- Convex setup/dev bootstrap: `bun run dev:setup`
- Build all: `bun run build`
- Typecheck all: `bun run check-types`
- Lint + format fix: `bun run check` (Oxlint + Oxfmt)

### Single Package / Targeted Commands

- Native app dev server: `bun run -C apps/native dev`
- Native platform builds: `bun run -C apps/native ios` or `bun run -C apps/native android`
- Backend dev: `bun run -C packages/backend dev`

### Tests (Important)

- No test runner configured in `package.json` yet.
- There is no single-test command.
- If you add tests, update this file with:
  - the runner name
  - how to run all tests
  - how to run a single test file and a single test case

## Ruler / Agent Rules

These rules come from `.ruler/bts.md`:

- Monorepo with `packages/backend/` and `apps/native/`
- Turborepo with Bun workspaces; run root scripts from repo root
- Auth uses Better Auth; config in `packages/backend/convex/auth.config.ts`
- Native auth client in `apps/native/lib/auth-client.ts`

Cursor/Copilot instructions: none found in `.cursor/rules/`, `.cursorrules`, or `.github/copilot-instructions.md`.

## Product and Domain Rules

- This product is a recovery-first Life OS; shame or guilt is a bug.
- Events are the source of truth; UI never mutates reality directly.
- State is derived via reducers from events; snapshots are cached only.
- Policies propose actions; they never mutate data.
- AI proposes; humans decide. Always use two-phase commit (propose → approve → execute).
- Every suggestion/action must include an explicit, human-readable reason.
- Never show more than 1–3 suggestions at once; scope reduction beats optimization.
- Rest is a valid state; low energy reduces decisions, not willpower.
- No streak shaming, no red warnings, no “missed” counters.
- Commands are validated and produce events; no direct DB writes from AI.
- Local-first: on-device is truth for “today”; server is shared truth across devices.
- Sync uses command outbox + idempotency keys; server validates and dedupes.

## Code Style and Conventions

### Language and Tooling

- TypeScript everywhere; strict typechecking enabled.
- Base TS config: `packages/config/tsconfig.base.json`.
- Compiler options include: `strict`, `moduleResolution: bundler`, `verbatimModuleSyntax`.
- Keep `noUnusedLocals`, `noUnusedParameters`, `noUncheckedIndexedAccess` clean.
- Lint/format via Oxlint/Oxfmt. Prefer `bun run check` before commits.

### Imports

- Group imports: external first, blank line, then internal (`@/` aliases or relative).
- Use `import type { ... }` for type-only imports.
- Avoid default exports unless required by framework (Expo Router screens/layouts do use default export).
- In native app, `@/` resolves from `apps/native` root.

### Naming

- Components: `PascalCase` (e.g., `SignIn`, `AppThemeProvider`).
- Hooks: `useX` naming; hook files can be `use-x.ts`.
- Files: `kebab-case` for generic modules, route files per Expo Router conventions.
- Env vars: `EXPO_PUBLIC_*` for client-exposed; keep server-only values in backend.
- Convex exports: use `query`/`mutation` names that describe data shape (e.g., `getCurrentUser`).

### Formatting

- Keep lines reasonably short; break long JSX props onto multiple lines.
- Prefer trailing commas in multi-line objects/arrays/functions.
- Use single responsibility per component/module; split large files.

### React Native / Expo

- Use Expo Router file-based routes in `apps/native/app/`.
- Layout/providers live in `apps/native/app/_layout.tsx`.
- Use `className` (Uniwind) for styling; prefer tailwind utilities over inline styles.
- Use HeroUI Native components for UI primitives when available.

### Routing and Navigation

- Route groups live under `apps/native/app/` (e.g., `(drawer)`, `(tabs)`).
- Keep screen components small; move logic to hooks or shared components.
- Use `+not-found.tsx` for unmatched routes.
- Expo Router screens/layouts require `export default`.

### Auth and Environment

- Auth uses Better Auth with Convex and Expo plugins.
- Server-only secrets belong in backend envs; client uses `EXPO_PUBLIC_*` only.
- Native auth client lives in `apps/native/lib/auth-client.ts`.
- Auth config lives in `packages/backend/convex/auth.config.ts`.

### Convex Backend

- Functions live in `packages/backend/convex/`.
- Use Convex `query`/`mutation` helpers and validators (`v.*`).
- Avoid editing files in `packages/backend/convex/_generated/`.
- Auth integration in `packages/backend/convex/auth.ts` and config in `packages/backend/convex/auth.config.ts`.
- Avoid accessing process env directly in client bundles; server-only envs stay backend-only.

### Types and Data

- Prefer explicit types for public APIs and context values.
- Use Zod for validation in shared env logic (`packages/env/`).
- Avoid `any`; use unions and narrowing instead.
- Keep data returned from Convex clean (no private fields).

### Error Handling

- Fail fast in hooks if provider missing (throw with clear message).
- For async UI actions, set loading state and surface errors via UI components.
- In Convex functions, validate inputs and return clean, minimal data.

### State and Side Effects

- Keep state local where possible; lift to context only when shared.
- Prefer `useMemo`/`useCallback` for derived values and stable handlers.
- Avoid side effects during render; use effects for async work.

## Environment Notes

- Convex setup may create `.env.local` in `packages/backend/`; copy to app envs if required.
- Native app uses `env.EXPO_PUBLIC_CONVEX_URL` and `env.EXPO_PUBLIC_CONVEX_SITE_URL`.

## When Adding or Changing Code

- Follow existing patterns in nearby files (imports, layout, state handling).
- Update this `AGENTS.md` if you add tests or new scripts.
- Avoid adding new tooling without updating root scripts and documentation.
- Keep changes scoped to the relevant package (`apps/native` vs `packages/backend`).
